# ETC Expense Checker

ETC利用明細から通勤区間を除外し、業務利用分のみを抽出するWebアプリケーション

## 概要

従業員から提出されるETC利用明細CSVファイルを読み込み、事前に設定した通勤区間（長坂IC ⇔ 自宅最寄りIC）の利用を自動的に除外することで、業務利用分のみを抽出できるツールです。経費精算の効率化に役立ちます。

## デモ

- **メインアプリ**: [https://iwaohig.github.io/etc-expense-checker/](https://iwaohig.github.io/etc-expense-checker/)
- **アップロード画面**: [https://iwaohig.github.io/etc-expense-checker/upload.html](https://iwaohig.github.io/etc-expense-checker/upload.html)

## 機能

### メインアプリ (index.html)

- **CSVファイル読み込み**
  - GitHubリポジトリからの自動読み込み
  - ローカルファイルのアップロード
  - Shift-JISエンコーディング対応

- **通勤区間設定**
  - 工場IC：長坂（固定）
  - 自宅最寄りICをプルダウンから選択
  - 選択したICは自動的に保存され、次回アクセス時に復元
  - 双方向の移動を自動認識

- **データ処理**
  - 通勤利用・業務利用・対象外の3分類
  - 手動で分類の修正が可能（クリックで切り替え）
  - 件数・金額の自動集計

- **エクスポート機能**
  - 業務利用分のみのCSVダウンロード
  - 元のフォーマットを維持

### アップロード画面 (upload.html)

- **ファイルアップロード**
  - ドラッグ&ドロップまたはクリックでファイル選択
  - モバイル最適化されたインターフェース

- **内容確認**
  - 利用期間の表示
  - 明細数の表示
  - 合計金額の計算・表示

- **アップロード処理**
  - 確認後のアップロード実行（デモ）

## 使い方

### 1. CSVファイルの準備

ETC利用明細のCSVファイルを準備します。以下の列を含む必要があります：
- 利用年月日（自）
- 時分（自）
- 利用ＩＣ（自）
- 利用ＩＣ（至）
- 通行料金
- 車両番号

注意：IC名に「IC」の文字は含めないでください（例：「八王子」であり「八王子IC」ではない）

### 2. 通勤区間の設定

1. 工場ICは「長坂」で固定されています
2. 自宅最寄りICをプルダウンから選択
3. 選択は自動的に保存され、次回アクセス時に復元されます

### 3. データの読み込みと処理

**GitHubから読み込む場合：**
1. 「GitHubから自動読み込み」を選択
2. CSV URLを入力（デフォルト: `./data/etc-data.csv`）
3. 「読み込み」ボタンをクリック

**ローカルファイルの場合：**
1. 「ローカルファイルをアップロード」を選択
2. ファイルを選択またはドラッグ&ドロップ

### 4. 結果の確認と修正

- 処理結果が表形式で表示されます
- 通勤利用分は赤色でハイライト
- 状態列をクリックすることで「業務」→「通勤」→「対象外」の順に切り替え可能
- 手動修正した項目には編集マーク（✏）が表示されます

### 5. データのダウンロード

- 「通勤除外データをダウンロード」で業務利用分のみをCSV形式で保存
- 通勤と対象外に分類されたデータは除外されます

## セットアップ

### GitHub Pagesでの公開

1. このリポジトリをフォークまたはクローン
2. `data`フォルダにCSVファイルを配置（オプション）
3. リポジトリの Settings → Pages でGitHub Pagesを有効化
4. Source を "Deploy from a branch" に設定
5. Branch を "main" / "/ (root)" に設定

### ローカルでの実行

```bash
git clone https://github.com/iwaohig/etc-expense-checker.git
cd etc-expense-checker
# HTTPサーバーを起動（Python 3の場合）
python -m http.server 8000
# ブラウザで http://localhost:8000 を開く
```

## ファイル構成

```
etc-expense-checker/
├── index.html      # メインアプリケーション
├── upload.html     # アップロード画面
├── data/           # CSVファイル配置用（オプション）
│   └── etc-data.csv
└── README.md       # このファイル
```

## データ分類

- **業務**: 業務で利用した高速道路料金（経費精算対象）
- **通勤**: 設定した通勤区間（長坂 ⇔ 自宅最寄りIC）の利用
- **対象外**: 私用利用など、経費精算対象外の利用

## 技術仕様

- **フロントエンド**: Vanilla JavaScript, HTML5, CSS3
- **CSVパース**: Papa Parse 5.3.0
- **文字エンコーディング**: Shift-JIS対応
- **ブラウザ要件**: モダンブラウザ（Chrome, Firefox, Safari, Edge）
- **データ保存**: localStorage（ブラウザローカルストレージ）

## 注意事項

- CSVファイルにETC利用明細以外の個人情報が含まれないよう注意してください
- GitHub Pagesで公開する場合、CSVファイルも公開されることに注意してください
- プライベートなデータを扱う場合は、ローカルファイルアップロード機能を使用してください
- IC名の表記は統一してください（「八王子」と「八王子IC」は別として認識されます）
- 自宅最寄りICの設定はブラウザのlocalStorageに保存されます

## ライセンス

MIT License

## 作者

iwaohig

## 貢献

Issue や Pull Request は歓迎します。大きな変更を加える場合は、まず Issue で議論してください。
